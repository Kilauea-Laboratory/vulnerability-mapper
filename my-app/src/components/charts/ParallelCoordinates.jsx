import React from "react";
import { ResponsiveParallelCoordinates } from "@nivo/parallel-coordinates";

const ParallelCoordinates = ({ data }) => {
  const getRandomShade = (value) => {
    let baseColor;

    if (value <= 3.0) {
      baseColor = "#008000"; // green
    } else if (value <= 6.0) {
      baseColor = "#FFFF00"; // yellow
    } else if (value <= 8.0) {
      baseColor = "#FFA500"; // orange
    } else {
      baseColor = "#FF0000"; // red
    }

    const darkenFactor = 0.7; // Adjust as needed, lower values make it darker
    const darkenedColor = baseColor
      .slice(1) // Remove the '#'
      .match(/.{2}/g) // Split into R, G, B components
      .map((channel) => {
        const darkenedValue = Math.round(parseInt(channel, 16) * darkenFactor);
        return darkenedValue.toString(16).padStart(2, "0");
      })
      .join("");

    return `#${darkenedColor}`;
  };



  // Assuming you've reformatted your data as described earlier
  const reformattedData = data.map((item) => ({
    baseScore: item["Base Score"],
    exploitabilityScore: item["Exploitability Score"],
    impactScore: item["Impact Score"],
    id: item["CVE"],
    color: getRandomShade(item["Base Score"]),
  }));

  return (
    <div style={{ height: "300px", width: "400px"}}>
      <ResponsiveParallelCoordinates
        data={reformattedData}
        variables={[
          {
            id: "baseScore",
            label: "Base Score",
            value: "baseScore",
            ticksPosition: "before",
            legendPosition: "start",
            legendOffset: 20,
            labelStyle: {
              fill: "grey",
              fontWeight: "bold",
            },
          },
          {
            id: "exploitabilityScore",
            label: "Exploitability Score",
            value: "exploitabilityScore",
            ticksPosition: "before",
            legendPosition: "start",
            legendOffset: 20,
            labelStyle: {
              fill: "grey",
              fontWeight: "bold",
            },
          },
          {
            id: "impactScore",
            label: "Impact Score",
            value: "impactScore",
            legendPosition: "start",
            legendOffset: -40,
            labelStyle: {
              fill: "grey",
              fontWeight: "bold",
            },
          },
        ]}
        margin={{ top: 20, right: 40, bottom: 20, left: 60 }}
        lineWidth={3}
        theme={{
          axis: {
            ticks: {
              text: {
                fill: "grey",
                fontWeight: "bold",
              },
            },
          },
        }}
        colors={(d) => d.color}
      />
    </div>
  );
};

export default ParallelCoordinates;
