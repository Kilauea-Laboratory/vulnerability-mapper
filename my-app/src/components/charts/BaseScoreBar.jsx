import React from 'react';
import { ResponsiveBar } from '@nivo/bar';

const roundBaseScores = (data) => {
  const roundedScores = {};
  data.forEach((item) => {
    const roundedScore = Math.round(item['Base Score']);
    roundedScores[roundedScore] = (roundedScores[roundedScore] || 0) + 1;
  });

  return Object.keys(roundedScores).map((score, index) => ({
    id: score,
    'Base Score': parseInt(score, 10),
    value: roundedScores[score],
  }));
};

const getShadeColor = (value) => {
  const normalizedValue = value / 10;
  const hue = Math.round((1 - normalizedValue) * 120);
  return `hsl(${hue}, 70%, 50%)`;
};

const BaseScoreBar = ({ data }) => {
  const roundedData = roundBaseScores(data);

  return (
    <div style={{ height: '240px', width: '530px' }}>
      <ResponsiveBar
        data={roundedData}
        keys={['value']}
        indexBy="id"
        margin={{ top: 10, right: 20, bottom: 50, left: 20 }}
        padding={0.3}
        valueScale={{ type: 'linear', min: 0, max: Math.max(...roundedData.map((d) => d.value)) }}
        indexScale={{ type: 'band', round: true }}
        colors={(d) => getShadeColor(d.data['Base Score'])} // Use the specified color for each bar
        borderColor={{ from: 'color', modifiers: [['darker', 1.6]] }}
        axisTop={null}
        axisRight={null}
        axisBottom={{
          tickSize: 5,
          tickPadding: 5,
          tickRotation: -40,
          legend: 'Base Score',
          legendPosition: 'middle',
          legendOffset: 36,
          tickValues: roundedData.map((d) => d.id),
        }}
        axisLeft={null}
        labelSkipWidth={12}
        labelSkipHeight={12}
        labelTextColor={{ from: 'color', modifiers: [['darker', 1.6]] }}
        role="application"
        ariaLabel="Nivo bar chart demo"
        barAriaLabel={(e) => `Count: ${e.formattedValue} for Base Score: ${e.indexValue}`}
        enableGridX={false} // Disable horizontal grid lines
        enableGridY={false} // Disable vertical grid lines
      />
    </div>
  );
};

export default BaseScoreBar;
