import React from 'react';
import { ResponsiveBar } from '@nivo/bar';

const exploitabilityScoreData = (data) => {
  const scores = {};
  data.forEach((item) => {
    const score = parseFloat(item['Exploitability Score']);
    scores[score] = (scores[score] || 0) + 1;
  });

  return Object.keys(scores).map((score) => ({
    id: parseFloat(score),
    'Exploitability Score': parseFloat(score),
    value: scores[score],
  }));
};

const getShadeColor = (value) => {
  const normalizedValue = (value - 0.5) / (3.9 - 0.5); // Normalize to the range 0 to 1
  const hue = Math.round((1 - normalizedValue) * 120);
  return `hsl(${hue}, 70%, 50%)`;
};

const ExploitabilityScoreBar = ({ data }) => {
  const scoreData = exploitabilityScoreData(data);

  // Convert id values to numbers for proper sorting
  scoreData.forEach((d) => {
    d.id = parseFloat(d.id);
  });

  // Sort the scoreData array by id
  scoreData.sort((a, b) => a.id - b.id);

  return (
    <div style={{ height: '186px', width: '320px' }}>
      <ResponsiveBar
        data={scoreData}
        keys={['value']}
        indexBy="id"
        margin={{ top: 10, right: 20, bottom: 50, left: 20 }}
        padding={0.3}
        valueScale={{ type: 'linear', min: 0, max: Math.max(...scoreData.map((d) => d.value)) }}
        indexScale={{ type: 'band', round: true }}
        colors={(d) => getShadeColor(d.data['Exploitability Score'])} // Use the specified color for each bar
        borderColor={{ from: 'color', modifiers: [['darker', 1.6]] }}
        axisTop={null}
        axisRight={null}
        axisBottom={{
          tickSize: 5,
          tickPadding: 5,
          tickRotation: -40,
          legend: 'Exploitability Score',
          legendPosition: 'middle',
          legendOffset: 36,
          tickValues: scoreData.map((d) => d.id),
        }}
        axisLeft={null}
        labelSkipWidth={12}
        labelSkipHeight={12}
        labelTextColor={{ from: 'color', modifiers: [['darker', 1.6]] }}
        role="application"
        ariaLabel="Nivo bar chart demo"
        barAriaLabel={(e) => `Count: ${e.formattedValue} for Exploitability Score: ${e.indexValue}`}
        enableGridX={false} // Disable horizontal grid lines
        enableGridY={false} // Disable vertical grid lines
      />
    </div>
  );
};

export default ExploitabilityScoreBar;
