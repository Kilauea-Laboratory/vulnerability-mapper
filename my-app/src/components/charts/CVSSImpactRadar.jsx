import React from "react";
import { ResponsiveRadar } from "@nivo/radar";

const CVSSImpactRadar = ({ data }) => {
  // Function to transform data and aggregate counts for each category
  const transformData = (data) => {
    const impactNames = {
      "C": "Confidentiality Impact",
      "I": "Integrity Impact",
      "A": "Availability Impact",
    };

    const aggregatedData = {
      "None": { "Confidentiality Impact": 0, "Integrity Impact": 0, "Availability Impact": 0 },
      "Low": { "Confidentiality Impact": 0, "Integrity Impact": 0, "Availability Impact": 0 },
      "High": { "Confidentiality Impact": 0, "Integrity Impact": 0, "Availability Impact": 0 },
    };

    try {
      data.forEach((entry, index) => {
        const { C, I, A } = entry;

        const categoryC = C === 'N' ? 'None' : (C === 'L' ? 'Low' : 'High');
        const categoryI = I === 'N' ? 'None' : (I === 'L' ? 'Low' : 'High');
        const categoryA = A === 'N' ? 'None' : (A === 'L' ? 'Low' : 'High');

        if (categoryC && categoryI && categoryA) {
          aggregatedData[categoryC]["Confidentiality Impact"] += 1;
          aggregatedData[categoryI]["Integrity Impact"] += 1;
          aggregatedData[categoryA]["Availability Impact"] += 1;
        } else {
          console.warn(`Invalid or missing values at index ${index}:`, entry);
        }
      });
    } catch (error) {
      console.error("Error processing data:", error);
    }

    const transformedData = Object.entries(aggregatedData).map(([taste, counts], index) => ({
      id: index,
      taste,
      ...counts
    }));

    return transformedData;
  };

  // Transform and aggregate data
  const transformedData = transformData(data);

  console.log("Transformed Data:", transformedData);

  return (
    <div style={{ height: "290px", width: "500px" }}>
      <ResponsiveRadar
        data={transformedData}
        keys={["Confidentiality Impact", "Integrity Impact", "Availability Impact"]}
        indexBy="taste"
        margin={{ top: 70, right: 80, bottom: 40, left: 80 }}
        borderColor={{ from: "color" }}
        gridLabelOffset={36}
        dotSize={10}
        dotColor={{ theme: "background" }}
        dotBorderWidth={2}
        colors={{ scheme: "nivo" }}
        blendMode="multiply"
        motionConfig="wobbly"
        legends={[
          {
            anchor: "top-left",
            direction: "column",
            translateX: -50,
            translateY: -40,
            itemWidth: 200,
            itemHeight: 20,
            itemTextColor: "#999",
            symbolSize: 12,
            symbolShape: "circle",
            effects: [
              {
                on: "hover",
                style: {
                  itemTextColor: "#000",
                },
              },
            ],
          },
        ]}
      />
    </div>
  );
};

export default CVSSImpactRadar;
