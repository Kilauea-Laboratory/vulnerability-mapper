import React from 'react';
import { ResponsiveBar } from '@nivo/bar';

const impactScoreData = (data) => {
  const scores = {};
  data.forEach((item) => {
    const score = parseFloat(item['Impact Score']);
    scores[score] = (scores[score] || 0) + 1;
  });

  return Object.keys(scores).map((score) => ({
    id: parseFloat(score),
    'Impact Score': parseFloat(score),
    value: scores[score],
  }));
};

const getShadeColor = (value) => {
  const normalizedValue = (value - 1.4) / (6 - 1.4); // Normalize to the range 0 to 1
  const hue = Math.round((1 - normalizedValue) * 120);
  return `hsl(${hue}, 70%, 50%)`;
};

const impactScoreBar = ({ data }) => {
  const scoreData = impactScoreData(data);

  // Convert id values to numbers for proper sorting
  scoreData.forEach((d) => {
    d.id = parseFloat(d.id);
  });

  // Sort the scoreData array by id
  scoreData.sort((a, b) => a.id - b.id);

  return (
    <div style={{ height: '260px', width: '500px' }}>
      <ResponsiveBar
        data={scoreData}
        keys={['value']}
        indexBy="id"
        margin={{ top: 50, right: 130, bottom: 50, left: 60 }}
        padding={0.3}
        valueScale={{ type: 'linear', min: 0, max: Math.max(...scoreData.map((d) => d.value)) }}
        indexScale={{ type: 'band', round: true }}
        colors={(d) => getShadeColor(d.data['Impact Score'])} // Use the specified color for each bar
        borderColor={{ from: 'color', modifiers: [['darker', 1.6]] }}
        axisTop={null}
        axisRight={null}
        axisBottom={{
          tickSize: 5,
          tickPadding: 5,
          tickRotation: 0,
          legend: 'Impact Score',
          legendPosition: 'middle',
          legendOffset: 32,
          tickValues: scoreData.map((d) => d.id),
        }}
        axisLeft={{
          tickSize: 5,
          tickPadding: 5,
          tickRotation: 0,
          legend: 'Count',
          legendPosition: 'middle',
          legendOffset: -40,
        }}
        labelSkipWidth={12}
        labelSkipHeight={12}
        labelTextColor={{ from: 'color', modifiers: [['darker', 1.6]] }}
        role="application"
        ariaLabel="Nivo bar chart demo"
        barAriaLabel={(e) => `Count: ${e.formattedValue} for Impact Score: ${e.indexValue}`}
      />
    </div>
  );
};

export default impactScoreBar;
