import React from "react";
import { ResponsiveRadar } from "@nivo/radar";

const CVSSExploitabilityRadar = ({ data }) => {
  // Function to transform data and aggregate counts for each category
  const transformData = (data) => {
    const exploitabilityNames = {
      "AC": "Attack Complexity",
      "PR": "Privileges Required",
    };

    const aggregatedData = {
      "None": { "Attack Complexity": 0, "Privileges Required": 0 },
      "Low": { "Attack Complexity": 0, "Privileges Required": 0 },
      "High": { "Attack Complexity": 0, "Privileges Required": 0 },
    };

    try {
      data.forEach((entry, index) => {
        const { AC, PR } = entry;

        const categoryAC = AC === 'L' ? 'Low' : (AC === 'H' ? 'High' : 'None');
        const categoryPR = PR === 'N' ? 'None' : (PR === 'L' ? 'Low' : 'High');

        if (categoryAC && categoryPR) {
          aggregatedData[categoryAC]["Attack Complexity"] += 1;
          aggregatedData[categoryPR]["Privileges Required"] += 1;
        } else {
          console.warn(`Invalid or missing values at index ${index}:`, entry);
        }
      });
    } catch (error) {
      console.error("Error processing data:", error);
    }

    const transformedData = Object.entries(aggregatedData).map(([taste, counts], index) => ({
      id: index,
      taste,
      ...counts
    }));

    return transformedData;
  };

  // Transform and aggregate data
  const transformedData = transformData(data);

  return (
    <div style={{ height: "320px", width: "400px" }}>
      <ResponsiveRadar
        data={transformedData}
        keys={["Attack Complexity", "Privileges Required"]}
        indexBy="taste"
        margin={{ top: 70, right: 40, bottom: 40, left: 80 }}
        borderColor={{ from: "color" }}
        gridLabelOffset={36}
        dotSize={10}
        dotColor={{ theme: "background" }}
        dotBorderWidth={2}
        colors={{ scheme: "nivo" }}
        blendMode="multiply"
        motionConfig="wobbly"
        legends={[
          {
            anchor: "top-left",
            direction: "column",
            translateX: -50,
            translateY: -40,
            itemWidth: 200,
            itemHeight: 20,
            itemTextColor: "#999",
            symbolSize: 12,
            symbolShape: "circle",
            effects: [
              {
                on: "hover",
                style: {
                  itemTextColor: "#000",
                },
              },
            ],
          },
        ]}
      />
    </div>
  );
};

export default CVSSExploitabilityRadar;
